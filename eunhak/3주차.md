# 대용량 트래픽을 해소하는 방법

## 로드밸런싱
사이트 : https://limjunho.github.io/2021/06/22/traffic-handling.html

### 정의
로드밸런싱(Load Balancing)이란 트래픽이 많을 때 여러 대의 서버가 분산처리하여 서버의 로드율을 증가, 부하량, 속도저하등 고려하여 분산처리하여 해결해주는 서비스이다.
<br>
로드밸런싱(Load Balancing)을 해주는 소프트웨어 혹은 하드웨어 장비를 로드밸런서(Load Balancer)라고 한다.


### 동작 방식
1.네트워크 상단에 L4 스위치 가상서버가 존재하여 서버로 들어오는 패킷을 리얼 서버로 균일하게 트래픽을 분산시킨다.<br>

2.서버에 장애가 발생하면 이를 감지하여 정상적으로 작동하는 서버로 트래픽을 분산시킨다.



<b>로드밸런싱은 하나의 서비스를 하나 이상의 노드가 처리하는 식으로 작동한다.<br>
  
로드밸런싱을 위한 서비스 요청 처리 알고리즘은 다양하다.</b>



### 종류

<b>L4 Load Balancing  <br></b>
L4계층에서 동작하는 Load Balancer이므로 네트워크 계층이나 트랜스포트 계층의 정보를 바탕으로 로드를 분산한다. <br>
즉, IP주소나 포트번호, MAC주소, 전송 프로토콜 등에 따라 트래픽을 나누고 분산처리 하는 것이 가능하다. <br>
이런 이유로 L4 Load Balancer를 CLB(Connection Load Balancer) 혹은 SLB(Session Load Balancer)라고 부르기도 한다.<br>

<b>L7 Load Balancing  <br></b>
L7 Load Balancer는 위와 같은 L4 Load Balancer의 기능을 포함하는 것 뿐만 아니라 OSI 7계층의 프로토콜을 바탕으로도 분산 처리가 가능하다.<br>


### 장점
1. 로드밸런싱을 이용하면 한 서버가 다운되더라도 이중화시킨 다른 서버에서 서비스를 지속하여, 사용자들이 문제를 인지하지 못하게 할 수 있다.<br>
2. 단지 노드를 추가하는 것만으로 서비스가 확장성을 가질 수 있다.






## 클러스터링
Clustering이란 여러 대의 컴퓨터를 똑같은 구성의 서버군을 병렬로 연결한 시스템으로 마치 하나의 컴퓨터처럼 사용하는 것을 말한다.
<br>

<span style = "color:red"><b>로드밸런서로 Clustering된 서버에 의해 서비스가 진행이 된다.</b></span>



<br>
<br>
<br>
<br>


### 2022/8/19 (3주차 스터디)



# HTTP 메서드 활용



# 클라이언트에서 서버로 데이터 전송


## 데이터 전달방식 (2가지)

### 쿼리 파라미터를 통한 데이터 전송
GET <br>
주로 정렬 필터(검색어)

### 메세지 바디를 통한 데이터 전송
POST, PUR, PATCH <br>
회원가입, 상품 준문, 리소스 등록, 리소스 변경


## 데이터를 전송하는 4가지 상황


### 정적 데이터 조회
• 이미지, 정적 텍스트 문서<br>
• 조회는 GET 사용<br>
• 쿼리파라미터 미사용<br>
### 동적 데이터 조회
• 주로 검색, 게시판 목록에서 정렬 필터(검색어)<br>
• 조회 조건을 줄여주는 필터, 조회 결과를 정렬하는 정렬 조건에 주로 사용<br>
• 쿼리파라미터 사용<br>
• 조회는 GET 사용<br>

### HTML Form을 통한 데이터 전송
• POST 전송( 회원 가입, 상품 주문, 데이터 변경)<br>
• Content-Type: application/x-www-form-urlencoded 사용<br>
&nbsp;&nbsp;&nbsp;• form의 내용을 메시지 바디를 통해서 전송(key=value, 쿼리 파라미터 형식)<br>
&nbsp;&nbsp;&nbsp;• 전송 데이터를 url encoding 처리<br>
• HTML Form은 GET 전송도 가능<br>

• Content-Type: multipart/form-data<br>
&nbsp;&nbsp;&nbsp;• 파일 업로드 같은 바이너리 데이터 전송시 사용<br>
&nbsp;&nbsp;&nbsp;• 다른 종류의 여러 파일과 폼의 내용 함께 전송 가능(그래서 이름이 multipart)<br>

• 참고: HTML Form 전송은 GET, POST만 지원<br>

### HTTP API를 통한 데이터 전송
• 회원 가입, 상품 주문, 데이터 변경<br>
• 서버 to 서버, 앱 클라이언트, 웹 클라이언트(Ajax)br>

• POST, PUT, PATCH: 메시지 바디를 통해 데이터 전송br>
• GET: 조회, 쿼리 파라미터로 데이터 전달br>
• Content-Type: application/json을 주로 사용 (사실상 표준)br>
&nbsp;&nbsp;&nbsp;• TEXT, XML, JSON 등등br>




# HTTP API 설계 예시


## 1. HTTP API - 컬렉션
### • POST 기반 등록
• 회원 목록 /members -> GET<br>
• 회원 등록 /members -> POST<br>
• 회원 조회 /members/{id} -> GET<br>
• 회원 수정 /members/{id} -> PATCH, PUT, POST<br>
• 회원 삭제 /members/{id} -> DELETE<br>

### POST - 신규 자원 등록 특징
• 클라이언트는 등록될 리소스의 URI를 모른다.<br>
• 서버가 새로 등록된 리소스 URI를 생성해준다.<br>


<b>
• 컬렉션(Collection)<br>
• 서버가 관리하는 리소스 디렉토리<br>
• 서버가 리소스의 URI를 생성하고 관리<br>
• 여기서 컬렉션은 /members<br>
</b>

## 2. HTTP API - 스토어
### • PUT 기반 등록
• 파일 목록 /files -> GET<br>
• 파일 조회 /files/{filename} -> GET<br>
• 파일 등록 /files/{filename} -> PUT<br>
• 파일 삭제 /files/{filename} -> DELETE<br>
• 파일 대량 등록 /files -> POST<br>

### PUT - 신규 자원 등록 특징
• 클라이언트가 리소스 URI를 알고 있어야 한다.<br>
• 클라이언트가 직접 리소스의 URI를 지정한다.<br>

<b>
• 스토어(Store)<br>
• 클라이언트가 관리하는 리소스 저장소<br>
• 클라이언트가 리소스의 URI를 알고 관리<br>
• 여기서 스토어는 /files<br>
</b>


## 3. HTML FORM 사용

• 회원 목록 /members -> GET<br>
• 회원 등록 폼 /members/new -> GET<br>
• 회원 등록 /members/new, /members -> POST<br>
• 회원 조회 /members/{id} -> GET<br>
• 회원 수정 폼 /members/{id}/edit -> GET<br>
• 회원 수정 /members/{id}/edit, /members/{id} -> POST<br>
• 회원 삭제 /members/{id}/delete -> POST<br>


• HTML FORM은 GET, POST만 지원<br>
• AJAX 같은 기술을 사용해서 해결 가능 -> 회원 API 참고<br>

### • 컨트롤 URI

• GET, POST만 지원하므로 제약이 있음<br>
• 이런 제약을 해결하기 위해 동사로 된 리소스 경로 사용<br>
• POST의 /new, /edit, /delete가 컨트롤 URI<br>
• HTTP 메서드로 해결하기 애매한 경우 사용(HTTP API 포함)<br>



# 참고하면 좋은 URI 설계 개념

### • 문서(document)
• 단일 개념(파일 하나, 객체 인스턴스, 데이터베이스 row)<br>
• 예) /members/100, /files/star.jpg<br>
### • 컬렉션(collection)
• 서버가 관리하는 리소스 디렉터리<br>
• 서버가 리소스의 URI를 생성하고 관리<br>
• 예) /members<br>
### • 스토어(store)
• 클라이언트가 관리하는 자원 저장소<br>
• 클라이언트가 리소스의 URI를 알고 관리<br>
• 예) /files<br>
### • 컨트롤러(controller), 컨트롤 URI
• 문서, 컬렉션, 스토어로 해결하기 어려운 추가 프로세스 실행<br>
• 동사를 직접 사용<br>
• 예) /members/{id}/delete<br>




